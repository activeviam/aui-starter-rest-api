"use strict";(self.webpackChunksaml_auth_extension=self.webpackChunksaml_auth_extension||[]).push([[197,179],{197:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var o=n(260),r=n.n(o),a=n(981);function i(e){const t=t=>{const[n,i]=(0,o.useState)((()=>{const e=localStorage.getItem("activeui-username"),t=localStorage.getItem("activeui-token");return t&&function(e){return(new Date).getTime()>1e3*e.exp}(s(t))?(localStorage.removeItem("activeui-username"),void localStorage.removeItem("activeui-token")):e&&t?{username:e,token:t}:void 0}));n||async function(){const e=await fetch(`${Object.values(window.env.activePivotServers)[0].url}/jwt/rest/v1/token`,{credentials:"include"});if(401===e.status){let e=encodeURI(window.location.href);e=e.replace("#","%23"),window.location.replace(`${Object.values(window.env.activePivotServers)[0].url}/saml/login?redirectTo=${e}`)}const t=(await e.json()).data.token,n=s(t).sub;return window.localStorage.setItem("activeui-username",n),window.localStorage.setItem("activeui-token",t),{username:n,token:t}}().then(i);const c=n?(0,a.getUserRoles)(n.token):[],u=(0,o.useMemo)((()=>{if(!n)return;const e={headers:{authorization:`Jwt ${n.token}`}};return{activePivot:{[Object.keys(window.env.activePivotServers)[0]]:(0,a.createActivePivotClient)({url:Object.values(window.env.activePivotServers)[0].url,version:{id:"6",restPath:"/pivot/rest/v6",wsPath:"/pivot/ws/v6"},requestInit:e})},contentClient:(0,a.createContentClient)({url:window.env.contentServerUrl,version:{id:"5",restPath:"/content/rest/v5",wsPath:"/content/ws/v5"},requestInit:e})}}),[n]);return n?r().createElement(a.UserProvider,{value:{username:n.username,userRoles:c}},r().createElement(a.ClientsProvider,{value:u},r().createElement(e,t))):r().createElement("div",null)};return t.displayName=`withCustomAuthentication(${e.displayName})`,t}function s(e){const t=e.split(".")[1],n=atob(t);return JSON.parse(n)}const c={activate:async e=>{"saml"===window.customEnv.security&&(e.higherOrderComponents=[i])}}}}]);